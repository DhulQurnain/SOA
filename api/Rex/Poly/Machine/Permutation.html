<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Rex::Poly::Machine::Permutation
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../';
  framesUrl = "../../../frames.html#!Rex/Poly/Machine/Permutation.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Poly.html" title="Rex::Poly (module)">Poly</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Machine.html" title="Rex::Poly::Machine (class)">Machine</a></span></span>
     &raquo; 
    <span class="title">Permutation</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Rex::Poly::Machine::Permutation
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Rex::Poly::Machine::Permutation</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/rex/poly/machine/machine.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>A Permutation!</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="SymbolicPermutation.html" title="Rex::Poly::Machine::SymbolicPermutation (class)">SymbolicPermutation</a></span></p>
</div>




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#active-instance_method" title="#active (instance method)">- (Object) <strong>active</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute active.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#args-instance_method" title="#args (instance method)">- (Object) <strong>args</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute args.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#length-instance_method" title="#length (instance method)">- (Object) <strong>length</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute length.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#name-instance_method" title="#name (instance method)">- (Object) <strong>name</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute name.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#offset-instance_method" title="#offset (instance method)">- (Object) <strong>offset</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute offset.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#primitive-instance_method" title="#primitive (instance method)">- (Object) <strong>primitive</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute primitive.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_child-instance_method" title="#add_child (instance method)">- (Object) <strong>add_child</strong>(child) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add in a child permutation to this one.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_children%3F-instance_method" title="#has_children? (instance method)">- (Boolean) <strong>has_children?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Does this permutation have children?.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Permutation) <strong>initialize</strong>(name, primitive, machine, source, args = nil) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new permutation object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_valid%3F-instance_method" title="#is_valid? (instance method)">- (Boolean) <strong>is_valid?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Test if this permutation raw buffer is valid in this machine (e.g. against
the badchar list).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_children-instance_method" title="#remove_children (instance method)">- (Object) <strong>remove_children</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove any existing children.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#render-instance_method" title="#render (instance method)">- (Object) <strong>render</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Actully render this permutation into a raw buffer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#solve-instance_method" title="#solve (instance method)">- (Object) <strong>solve</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Try to find a solution within the solution space by performing a depth
first search into the permutation tree and backtracking when needed.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Rex::Poly::Machine::Permutation (class)">Permutation</a></span></tt>) <strong>initialize</strong>(name, primitive, machine, source, args = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new permutation object.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34
35
36
37
38
39
40
41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_primitive'>primitive</span><span class='comma'>,</span> <span class='id identifier rubyid_machine'>machine</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='op'>=</span><span class='kw'>nil</span> <span class='rparen'>)</span>
  <span class='ivar'>@name</span>      <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@primitive</span> <span class='op'>=</span> <span class='id identifier rubyid_primitive'>primitive</span>
  <span class='ivar'>@machine</span>   <span class='op'>=</span> <span class='id identifier rubyid_machine'>machine</span>
  <span class='ivar'>@source</span>    <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span>
  <span class='ivar'>@args</span>      <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='ivar'>@active</span>    <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@valid</span>     <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@length</span>    <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@offset</span>    <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@children</span>  <span class='op'>=</span> <span class='op'>::</span><span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="active=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="active-instance_method">
  
    - (<tt>Object</tt>) <strong>active</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute active</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_active'>active</span>
  <span class='ivar'>@active</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="args-instance_method">
  
    - (<tt>Object</tt>) <strong>args</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute args</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_args'>args</span>
  <span class='ivar'>@args</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="length-instance_method">
  
    - (<tt>Object</tt>) <strong>length</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute length</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@length</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="name-instance_method">
  
    - (<tt>Object</tt>) <strong>name</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute name</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="offset=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="offset-instance_method">
  
    - (<tt>Object</tt>) <strong>offset</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute offset</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_offset'>offset</span>
  <span class='ivar'>@offset</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="primitive-instance_method">
  
    - (<tt>Object</tt>) <strong>primitive</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute primitive</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_primitive'>primitive</span>
  <span class='ivar'>@primitive</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_child-instance_method">
  
    - (<tt>Object</tt>) <strong>add_child</strong>(child) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add in a child permutation to this one. Used to build the permutation tree.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_child'>add_child</span><span class='lparen'>(</span> <span class='id identifier rubyid_child'>child</span> <span class='rparen'>)</span>
  <span class='ivar'>@children</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_child'>child</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_children?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>has_children?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Does this permutation have children?</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_children?'>has_children?</span>
  <span class='kw'>not</span> <span class='ivar'>@children</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_valid?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>is_valid?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Test if this permutation raw buffer is valid in this machine (e.g. against
the badchar list).</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 120</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_valid?'>is_valid?</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>if</span><span class='lparen'>(</span> <span class='ivar'>@valid</span> <span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_is_valid?'>is_valid?</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_render'>render</span> <span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>UnallowedPermutation</span>
      <span class='comment'># This permutation is unallowed and can never be rendered so just mark it as
</span>      <span class='comment'># not valid to skip it during future attempts.
</span>      <span class='ivar'>@valid</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>rescue</span> <span class='const'>UndefinedPermutation</span>
      <span class='comment'># allow an undefined permutation to fail validation but keep it marked
</span>      <span class='comment'># as valid as it may be defined and passed validation later.
</span>    <span class='kw'>ensure</span>
      <span class='comment'># Should a temporary variable have been assigned we can release it here.
</span>      <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_release_temp_variable'>release_temp_variable</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_children-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_children</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove any existing children. Called by the machines generate function to
build a fresh tree in case generate was previously called.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_children'>remove_children</span>
  <span class='ivar'>@children</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="render-instance_method">
  
    - (<tt>Object</tt>) <strong>render</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Actully render this permutation into a raw buffer.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 70</span>

<span class='kw'>def</span> <span class='id identifier rubyid_render'>render</span>
  <span class='id identifier rubyid_raw'>raw</span>   <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># Zero the length as we will be rendering the raw buffer and the length may change.
</span>  <span class='ivar'>@length</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='comment'># If this permutation source is a Primitive/Procedure we can call it, otherwise we have a string
</span>  <span class='kw'>if</span><span class='lparen'>(</span> <span class='ivar'>@source</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span> <span class='const'>Primitive</span> <span class='rparen'>)</span> <span class='kw'>or</span> <span class='ivar'>@source</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span> <span class='op'>::</span><span class='const'>Proc</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
    <span class='kw'>if</span><span class='lparen'>(</span> <span class='ivar'>@source</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span> <span class='const'>Primitive</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='ivar'>@source</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span> <span class='ivar'>@name</span><span class='comma'>,</span> <span class='ivar'>@machine</span><span class='comma'>,</span> <span class='op'>*</span><span class='ivar'>@args</span> <span class='rparen'>)</span>
    <span class='kw'>elsif</span><span class='lparen'>(</span> <span class='ivar'>@source</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span> <span class='op'>::</span><span class='const'>Proc</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='ivar'>@source</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span>
    <span class='kw'>end</span>
    <span class='comment'># If the primitive/procedure returned an array, it is an array of assembly strings which we can assemble.
</span>    <span class='kw'>if</span><span class='lparen'>(</span> <span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span> <span class='op'>::</span><span class='const'>Array</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='id identifier rubyid_raw'>raw</span>
      <span class='id identifier rubyid_raw'>raw</span>   <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
      <span class='comment'># itterate over each line of assembly
</span>      <span class='id identifier rubyid_lines'>lines</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span> <span class='id identifier rubyid_asm'>asm</span> <span class='op'>|</span>
        <span class='comment'># parse the asm and substitute in any offset values specified...
</span>        <span class='id identifier rubyid_offsets'>offsets</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:([\S]+)_offset</span><span class='regexp_end'>/</span></span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_offsets'>offsets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>|</span>
          <span class='id identifier rubyid_asm'>asm</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_offset</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_block_offset'>block_offset</span><span class='lparen'>(</span> <span class='id identifier rubyid_name'>name</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='comment'># and substitute in and register values for any variables specified...
</span>        <span class='id identifier rubyid_regs'>regs</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:([\S]+)_reg([\d]+)</span><span class='regexp_end'>/</span></span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_regs'>regs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>|</span>
          <span class='id identifier rubyid_asm'>asm</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_reg</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_variable_value'>variable_value</span><span class='lparen'>(</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='comment'># assemble it into a raw blob
</span>        <span class='id identifier rubyid_blob'>blob</span> <span class='op'>=</span> <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_assemble'>assemble</span><span class='lparen'>(</span> <span class='id identifier rubyid_asm'>asm</span> <span class='rparen'>)</span>
        <span class='comment'>#if( not @machine.is_valid?( blob ) )
</span>        <span class='comment'>#	p &quot;#{name}(#{primitive}):#{asm} is invalid&quot;
</span>        <span class='comment'>#end
</span>        <span class='id identifier rubyid_raw'>raw</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_blob'>blob</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># the source must just be a static string
</span>    <span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='ivar'>@source</span>
  <span class='kw'>end</span>
  <span class='comment'># Update the length to reflect the new raw buffer
</span>  <span class='ivar'>@length</span> <span class='op'>=</span> <span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='comment'># As the temp variable is only assigned for the duration of a single permutation we
</span>  <span class='comment'># can now release it if it was used in this permutation.
</span>  <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_release_temp_variable'>release_temp_variable</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="solve-instance_method">
  
    - (<tt>Object</tt>) <strong>solve</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Try to find a solution within the solution space by performing a depth
first search into the permutation tree and backtracking when needed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/poly/machine/machine.rb', line 144</span>

<span class='kw'>def</span> <span class='id identifier rubyid_solve'>solve</span>
  <span class='comment'># Check to see if this permutation can make part of a valid solution
</span>  <span class='kw'>if</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_valid?'>is_valid?</span> <span class='rparen'>)</span>
    <span class='comment'># record this permutation as part of the final solution (the current machines register state is also saved here)
</span>    <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_solution_push'>solution_push</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span>
    <span class='comment'># If we have no children we are at the end of the tree and have a potential full solution.
</span>    <span class='kw'>if</span><span class='lparen'>(</span> <span class='kw'>not</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_has_children?'>has_children?</span> <span class='rparen'>)</span>
      <span class='comment'># We have a solution but doing a final pass to update offsets may introduce bad chars
</span>      <span class='comment'># so we test for this and keep searching if this isnt a real solution after all.
</span>      <span class='kw'>if</span><span class='lparen'>(</span> <span class='kw'>not</span> <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_solution_is_valid?'>solution_is_valid?</span> <span class='rparen'>)</span>
        <span class='comment'># remove this permutation and keep searching
</span>        <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_solution_pop'>solution_pop</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
      <span class='comment'># Return true to unwind the recursive call as we have got a final solution.
</span>      <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='comment'># Itterate over the children of this permutation (the perutations of the proceeding block).
</span>    <span class='ivar'>@children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span> <span class='id identifier rubyid_child'>child</span> <span class='op'>|</span>
      <span class='comment'># Traverse into this child to keep trying to generate a solution...
</span>      <span class='kw'>if</span><span class='lparen'>(</span> <span class='id identifier rubyid_child'>child</span><span class='period'>.</span><span class='id identifier rubyid_solve'>solve</span> <span class='rparen'>)</span>
        <span class='comment'># Keep returning true to unwind as we are done.
</span>        <span class='kw'>return</span> <span class='kw'>true</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'># If we get here this permutation, origionally thought to be good for a solution, is not after all,
</span>    <span class='comment'># so remove it from the machines final solution, restoring the register state aswell.
</span>    <span class='ivar'>@machine</span><span class='period'>.</span><span class='id identifier rubyid_solution_pop'>solution_pop</span>
  <span class='kw'>end</span>
  <span class='comment'># No children can be made form part of the solution, return failure for this path in the tree.
</span>  <span class='kw'>return</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Jan 19 22:37:30 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.7).
</div>

  </body>
</html>