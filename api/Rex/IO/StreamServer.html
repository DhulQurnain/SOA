<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Rex::IO::StreamServer
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Rex/IO/StreamServer.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Rex.html" title="Rex (module)">Rex</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../IO.html" title="Rex::IO (module)">IO</a></span></span>
     &raquo; 
    <span class="title">StreamServer</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Rex::IO::StreamServer
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="../Socket/TcpServer.html" title="Rex::Socket::TcpServer (module)">Socket::TcpServer</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/rex/io/stream_server.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This mixin provides the framework and interface for implementing a
streaming server that can listen for and accept stream client connections. 
Stream servers extend this class and are required to implement the
following methods:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_accept'>accept</span>
<span class='id identifier rubyid_fd'>fd</span></code></pre>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#client_waiter-instance_method" title="#client_waiter (instance method)">- (Object) <strong>client_waiter</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute client_waiter.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#clients-instance_method" title="#clients (instance method)">- (Object) <strong>clients</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#clients_thread-instance_method" title="#clients_thread (instance method)">- (Object) <strong>clients_thread</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#listener_thread-instance_method" title="#listener_thread (instance method)">- (Object) <strong>listener_thread</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_client_close_proc-instance_method" title="#on_client_close_proc (instance method)">- (Object) <strong>on_client_close_proc</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This callback procedure can be set and will be called when a client
disconnects from the server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_client_connect_proc-instance_method" title="#on_client_connect_proc (instance method)">- (Object) <strong>on_client_connect_proc</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This callback procedure can be set and will be called when new clients
connect.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_client_data_proc-instance_method" title="#on_client_data_proc (instance method)">- (Object) <strong>on_client_data_proc</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This callback procedure can be set and will be called when clients have
data to be processed.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close_client-instance_method" title="#close_client (instance method)">- (Object) <strong>close_client</strong>(client) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method closes a client connection and cleans up the resources
associated with it.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#monitor_clients-instance_method" title="#monitor_clients (instance method)">- (Object) <strong>monitor_clients</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method monitors client connections for data and calls the
<code>on_client_data</code> routine when new data arrives.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#monitor_listener-instance_method" title="#monitor_listener (instance method)">- (Object) <strong>monitor_listener</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method monitors the listener socket for new connections and calls the
<code>on_client_connect</code> callback routine.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_client_close-instance_method" title="#on_client_close (instance method)">- (Object) <strong>on_client_close</strong>(client) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This callback is notified when a client connection has closed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_client_connect-instance_method" title="#on_client_connect (instance method)">- (Object) <strong>on_client_connect</strong>(client) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This callback is notified when a client connects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_client_data-instance_method" title="#on_client_data (instance method)">- (Object) <strong>on_client_data</strong>(client) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This callback is notified when a client connection has data that needs to
be processed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">- (Object) <strong>start</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Start monitoring the listener socket for connections and keep track of all
client connections.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">- (Object) <strong>stop</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Terminates the listener monitoring threads and closes all active clients.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wait-instance_method" title="#wait (instance method)">- (Object) <strong>wait</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method waits on the server listener thread.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="client_waiter=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="client_waiter-instance_method">
  
    - (<tt>Object</tt>) <strong>client_waiter</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute client_waiter</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 135</span>

<span class='kw'>def</span> <span class='id identifier rubyid_client_waiter'>client_waiter</span>
  <span class='ivar'>@client_waiter</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="clients=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="clients-instance_method">
  
    - (<tt>Object</tt>) <strong>clients</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 133</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clients'>clients</span>
  <span class='ivar'>@clients</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="clients_thread=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="clients_thread-instance_method">
  
    - (<tt>Object</tt>) <strong>clients_thread</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 134</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clients_thread'>clients_thread</span>
  <span class='ivar'>@clients_thread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="listener_thread=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="listener_thread-instance_method">
  
    - (<tt>Object</tt>) <strong>listener_thread</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 134</span>

<span class='kw'>def</span> <span class='id identifier rubyid_listener_thread'>listener_thread</span>
  <span class='ivar'>@listener_thread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="on_client_close_proc=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="on_client_close_proc-instance_method">
  
    - (<tt>Object</tt>) <strong>on_client_close_proc</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This callback procedure can be set and will be called when a client
disconnects from the server.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 131</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_client_close_proc'>on_client_close_proc</span>
  <span class='ivar'>@on_client_close_proc</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="on_client_connect_proc=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="on_client_connect_proc-instance_method">
  
    - (<tt>Object</tt>) <strong>on_client_connect_proc</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This callback procedure can be set and will be called when new clients
connect.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 121</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_client_connect_proc'>on_client_connect_proc</span>
  <span class='ivar'>@on_client_connect_proc</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="on_client_data_proc=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="on_client_data_proc-instance_method">
  
    - (<tt>Object</tt>) <strong>on_client_data_proc</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This callback procedure can be set and will be called when clients have
data to be processed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 126</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_client_data_proc'>on_client_data_proc</span>
  <span class='ivar'>@on_client_data_proc</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="close_client-instance_method">
  
    - (<tt>Object</tt>) <strong>close_client</strong>(client) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method closes a client connection and cleans up the resources
associated with it.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 93</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close_client'>close_client</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_clients'>clients</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>rescue</span> <span class='const'>IOError</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="monitor_clients-instance_method">
  
    - (<tt>Object</tt>) <strong>monitor_clients</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method monitors client connections for data and calls the
<code>on_client_data</code> routine when new data arrives.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 179</span>

<span class='kw'>def</span> <span class='id identifier rubyid_monitor_clients'>monitor_clients</span>
  <span class='kw'>begin</span>

    <span class='comment'># Wait for a notify if our client list is empty
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_clients'>clients</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_client_waiter'>client_waiter</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_sd'>sd</span> <span class='op'>=</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>ThreadSafe</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='id identifier rubyid_clients'>clients</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_sd'>sd</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cfd'>cfd</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_on_client_data'>on_client_data</span><span class='lparen'>(</span><span class='id identifier rubyid_cfd'>cfd</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>EOFError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNRESET</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOTCONN</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNABORTED</span>
        <span class='id identifier rubyid_on_client_close'>on_client_close</span><span class='lparen'>(</span><span class='id identifier rubyid_cfd'>cfd</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_close_client'>close_client</span><span class='lparen'>(</span><span class='id identifier rubyid_cfd'>cfd</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Interrupt</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='gvar'>$!</span>
      <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Exception</span>
        <span class='id identifier rubyid_close_client'>close_client</span><span class='lparen'>(</span><span class='id identifier rubyid_cfd'>cfd</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_elog'>elog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error in stream server client monitor: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_rlog'>rlog</span><span class='lparen'>(</span><span class='const'>ExceptionCallStack</span><span class='rparen'>)</span>

      <span class='kw'>end</span>
    <span class='rbrace'>}</span>

  <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Rex</span><span class='op'>::</span><span class='const'>StreamClosedError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='comment'># Remove the closed stream from the list
</span>    <span class='id identifier rubyid_clients'>clients</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_stream'>stream</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Interrupt</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='gvar'>$!</span>
  <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Exception</span>
    <span class='id identifier rubyid_elog'>elog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error in stream server client monitor: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rlog'>rlog</span><span class='lparen'>(</span><span class='const'>ExceptionCallStack</span><span class='rparen'>)</span>
  <span class='kw'>end</span> <span class='kw'>while</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="monitor_listener-instance_method">
  
    - (<tt>Object</tt>) <strong>monitor_listener</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method monitors the listener socket for new connections and calls the
<code>on_client_connect</code> callback routine.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_monitor_listener'>monitor_listener</span>

  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_cli'>cli</span> <span class='op'>=</span> <span class='id identifier rubyid_accept'>accept</span>
      <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_cli'>cli</span>
        <span class='id identifier rubyid_elog'>elog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The accept() returned nil in stream server listener monitor:  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_fd'>fd</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='op'>::</span><span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='float'>0.10</span><span class='rparen'>)</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='comment'># Append to the list of clients
</span>      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clients'>clients</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cli'>cli</span>

      <span class='comment'># Initialize the connection processing
</span>      <span class='id identifier rubyid_on_client_connect'>on_client_connect</span><span class='lparen'>(</span><span class='id identifier rubyid_cli'>cli</span><span class='rparen'>)</span>

      <span class='comment'># Notify the client monitor
</span>      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_client_waiter'>client_waiter</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_cli'>cli</span><span class='rparen'>)</span>

    <span class='comment'># Skip exceptions caused by accept() [ SSL ]
</span>    <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>EOFError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNRESET</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOTCONN</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNABORTED</span>
    <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Interrupt</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='gvar'>$!</span>
    <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Exception</span>
      <span class='id identifier rubyid_elog'>elog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error in stream server server monitor: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$!</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_rlog'>rlog</span><span class='lparen'>(</span><span class='const'>ExceptionCallStack</span><span class='rparen'>)</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_client_close-instance_method">
  
    - (<tt>Object</tt>) <strong>on_client_close</strong>(client) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This callback is notified when a client connection has closed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_client_close'>on_client_close</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_on_client_close_proc'>on_client_close_proc</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_on_client_close_proc'>on_client_close_proc</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_client_connect-instance_method">
  
    - (<tt>Object</tt>) <strong>on_client_connect</strong>(client) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This callback is notified when a client connects.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_client_connect'>on_client_connect</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_on_client_connect_proc'>on_client_connect_proc</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_on_client_connect_proc'>on_client_connect_proc</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_client_data-instance_method">
  
    - (<tt>Object</tt>) <strong>on_client_data</strong>(client) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This callback is notified when a client connection has data that needs to
be processed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 46</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_client_data'>on_client_data</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_on_client_data_proc'>on_client_data_proc</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_on_client_data_proc'>on_client_data_proc</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_client'>client</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start-instance_method">
  
    - (<tt>Object</tt>) <strong>start</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Start monitoring the listener socket for connections and keep track of all
client connections.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 65</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clients'>clients</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_client_waiter'>client_waiter</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Queue</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_listener_thread'>listener_thread</span> <span class='op'>=</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>ThreadFactory</span><span class='period'>.</span><span class='id identifier rubyid_spawn'>spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StreamServerListener</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_monitor_listener'>monitor_listener</span>
  <span class='rbrace'>}</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clients_thread'>clients_thread</span> <span class='op'>=</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>ThreadFactory</span><span class='period'>.</span><span class='id identifier rubyid_spawn'>spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StreamServerClientMonitor</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_monitor_clients'>monitor_clients</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop-instance_method">
  
    - (<tt>Object</tt>) <strong>stop</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Terminates the listener monitoring threads and closes all active clients.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_listener_thread'>listener_thread</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clients_thread'>clients_thread</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clients'>clients</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cli'>cli</span><span class='op'>|</span>
    <span class='id identifier rubyid_close_client'>close_client</span><span class='lparen'>(</span><span class='id identifier rubyid_cli'>cli</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wait-instance_method">
  
    - (<tt>Object</tt>) <strong>wait</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method waits on the server listener thread</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_server.rb', line 107</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wait'>wait</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_listener_thread'>listener_thread</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_listener_thread'>listener_thread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Jan 19 22:35:18 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.7).
</div>

  </body>
</html>