<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Msf::ModuleManager::Cache
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Msf/ModuleManager/Cache.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Msf.html" title="Msf (module)">Msf</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../ModuleManager.html" title="Msf::ModuleManager (class)">ModuleManager</a></span></span>
     &raquo; 
    <span class="title">Cache</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Msf::ModuleManager::Cache
  
  
  
</h1>

<dl class="box">
  
  
    
      <dt class="r1">Extended by:</dt>
      <dd class="r1">ActiveSupport::Concern</dd>
      
    
  
    
  
  
    <dt class="r2">Included in:</dt>
    <dd class="r2"><span class='object_link'><a href="../ModuleManager.html" title="Msf::ModuleManager (class)">Msf::ModuleManager</a></span></dd>
    
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/msf/core/module_manager/cache.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Concerns the module cache maintained by the <span class='object_link'><a href="../ModuleManager.html" title="Msf::ModuleManager (class)">Msf::ModuleManager</a></span>.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="protected ">
  <span class="summary_signature">
    
      <a href="#module_info_by_path-instance_method" title="#module_info_by_path (instance method)">- (Hash{String =&gt; Hash{Symbol =&gt; Object}}) <strong>module_info_by_path</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Maps path (Mdm::Module::Detail#file) to module information.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cache_empty%3F-instance_method" title="#cache_empty? (instance method)">- (true, false) <strong>cache_empty?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns whether the cache is empty.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cache_in_memory-instance_method" title="#cache_in_memory (instance method)">- (void) <strong>cache_in_memory</strong>(class_or_module, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates the in-memory cache so that <span class='object_link'><a href="Loading.html#file_changed%3F-instance_method" title="Msf::ModuleManager::Loading#file_changed? (method)">Loading#file_changed?</a></span> will report
<code>false</code> if the module is loaded again.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#framework_migrated%3F-instance_method" title="#framework_migrated? (instance method)">- (true, false) <strong>framework_migrated?</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns whether the framework migrations have been run already.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_cached_module-instance_method" title="#load_cached_module (instance method)">- (false, true) <strong>load_cached_module</strong>(type, reference_name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Forces loading of the module with the given type and module reference name
from the cache.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#module_info_by_path_from_database%21-instance_method" title="#module_info_by_path_from_database! (instance method)">- (Hash{String =&gt; Hash{Symbol =&gt; Object}}) <strong>module_info_by_path_from_database!</strong>(allowed_paths = [&quot;&quot;]) </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return a module info from Mdm::Module::Details in database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#refresh_cache_from_database-instance_method" title="#refresh_cache_from_database (instance method)">- (void) <strong>refresh_cache_from_database</strong>(allowed_paths = [&quot;&quot;]) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Refreshes the in-memory cache from the database cache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#refresh_cache_from_module_files-instance_method" title="#refresh_cache_from_module_files (instance method)">- (Object) <strong>refresh_cache_from_module_files</strong>(module_class_or_instance = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="module_info_by_path=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="module_info_by_path-instance_method">
  
    - (<tt>Hash{String =&gt; Hash{Symbol =&gt; Object}}</tt>) <strong>module_info_by_path</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns Maps path (Mdm::Module::Detail#file) to module information.  Module
information is a Hash derived from Mdm::Module::Detail.  It includes
:modification_time, :parent_path, :type, :reference_name.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{String =&gt; Hash{Symbol =&gt; Object}}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Maps path (Mdm::Module::Detail#file) to module information.  Module
information is a Hash derived from Mdm::Module::Detail.  It includes
:modification_time, :parent_path, :type, :reference_name.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/module_manager/cache.rb', line 138</span>

<span class='kw'>def</span> <span class='id identifier rubyid_module_info_by_path'>module_info_by_path</span>
  <span class='ivar'>@module_info_by_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="cache_empty?-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>cache_empty?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns whether the cache is empty</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the cache has no entries.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the cache has any entries.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/module_manager/cache.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_empty?'>cache_empty?</span>
  <span class='id identifier rubyid_module_info_by_path'>module_info_by_path</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cache_in_memory-instance_method">
  
    - (<tt>void</tt>) <strong>cache_in_memory</strong>(class_or_module, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>path, reference_name, and type must be passed as options because when
<code>class_or_module</code> is a payload Module, those attributes will
either not be set or not exist on the module.</p>
</div>
  </div>

<p class="note returns_void">This method returns an undefined value.</p>
<p>Updates the in-memory cache so that <span class='object_link'><a href="Loading.html#file_changed%3F-instance_method" title="Msf::ModuleManager::Loading#file_changed? (method)">Loading#file_changed?</a></span> will report
<code>false</code> if the module is loaded again.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>class_or_module</span>
      
      
        <span class='type'>(<tt>Class&lt;<span class='object_link'><a href="../Module.html" title="Msf::Module (class)">Msf::Module</a></span>&gt;</tt>, <tt>::Module</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>either a module Class or a payload Module.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash{Symbol =&gt; String}</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:path</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the path to the file from which <code>class_or_module</code> was loaded.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:reference_name</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the reference name for <code>class_or_module</code>.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:type</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the module type</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>KeyError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unless <code>:path</code> is given.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>KeyError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unless <code>:reference_name</code> is given.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>KeyError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unless <code>:type</code> is given.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/module_manager/cache.rb', line 37</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_in_memory'>cache_in_memory</span><span class='lparen'>(</span><span class='id identifier rubyid_class_or_module'>class_or_module</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_assert_valid_keys'>assert_valid_keys</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:reference_name</span><span class='comma'>,</span> <span class='symbol'>:type</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='rparen'>)</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_modification_time'>modification_time</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_mtime'>mtime</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
    <span class='id identifier rubyid_log_lines'>log_lines</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_log_lines'>log_lines</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not find the modification of time of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_log_lines'>log_lines</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_log_lines'>log_lines</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_log_lines'>log_lines</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Call stack:</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_log_lines'>log_lines</span> <span class='op'>+=</span> <span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>

    <span class='id identifier rubyid_log_message'>log_message</span> <span class='op'>=</span> <span class='id identifier rubyid_log_lines'>log_lines</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_elog'>elog</span><span class='lparen'>(</span><span class='id identifier rubyid_log_message'>log_message</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_parent_path'>parent_path</span> <span class='op'>=</span> <span class='id identifier rubyid_class_or_module'>class_or_module</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_parent_path'>parent_path</span>
    <span class='id identifier rubyid_reference_name'>reference_name</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:reference_name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:type</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_module_info_by_path'>module_info_by_path</span><span class='lbracket'>[</span><span class='id identifier rubyid_path'>path</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
        <span class='symbol'>:modification_time</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_modification_time'>modification_time</span><span class='comma'>,</span>
        <span class='symbol'>:parent_path</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_parent_path'>parent_path</span><span class='comma'>,</span>
        <span class='symbol'>:reference_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_reference_name'>reference_name</span><span class='comma'>,</span>
        <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_type'>type</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="framework_migrated?-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>framework_migrated?</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns whether the framework migrations have been run already.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if migrations have been run</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>otherwise</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/module_manager/cache.rb', line 132</span>

<span class='kw'>def</span> <span class='id identifier rubyid_framework_migrated?'>framework_migrated?</span>
  <span class='id identifier rubyid_framework'>framework</span><span class='period'>.</span><span class='id identifier rubyid_db'>db</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_framework'>framework</span><span class='period'>.</span><span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_migrated'>migrated</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_cached_module-instance_method">
  
    - (<tt>false</tt>, <tt>true</tt>) <strong>load_cached_module</strong>(type, reference_name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Forces loading of the module with the given type and module reference name
from the cache.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the type of the module.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>reference_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the module reference name.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if a module with the given type and reference name does not exist in the
cache.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if :force is false and parent_path has not changed.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if exception encountered while parsing module content</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the module is incompatible with the Core or API version.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the module does not implement a Metasploit(d+) class.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the module&#39;s is_usable method returns false.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if all those condition pass and the module is successfully loaded.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/module_manager/cache.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_cached_module'>load_cached_module</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_reference_name'>reference_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_loaded'>loaded</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='id identifier rubyid_module_info'>module_info</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_module_info_by_path'>module_info_by_path</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_inner_info'>inner_info</span><span class='op'>|</span>
    <span class='id identifier rubyid_inner_info'>inner_info</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_type'>type</span> <span class='kw'>and</span> <span class='id identifier rubyid_inner_info'>inner_info</span><span class='lbracket'>[</span><span class='symbol'>:reference_name</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_reference_name'>reference_name</span>
  <span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_module_info'>module_info</span>
    <span class='id identifier rubyid_parent_path'>parent_path</span> <span class='op'>=</span> <span class='id identifier rubyid_module_info'>module_info</span><span class='lbracket'>[</span><span class='symbol'>:parent_path</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_loaders'>loaders</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_loader'>loader</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_loader'>loader</span><span class='period'>.</span><span class='id identifier rubyid_loadable?'>loadable?</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_path'>parent_path</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_module_info'>module_info</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_reference_name'>reference_name</span> <span class='op'>=</span> <span class='id identifier rubyid_module_info'>module_info</span><span class='lbracket'>[</span><span class='symbol'>:reference_name</span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_loaded'>loaded</span> <span class='op'>=</span> <span class='id identifier rubyid_loader'>loader</span><span class='period'>.</span><span class='id identifier rubyid_load_module'>load_module</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_path'>parent_path</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_reference_name'>reference_name</span><span class='comma'>,</span> <span class='symbol'>:force</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>

        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_loaded'>loaded</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="module_info_by_path_from_database!-instance_method">
  
    - (<tt>Hash{String =&gt; Hash{Symbol =&gt; Object}}</tt>) <strong>module_info_by_path_from_database!</strong>(allowed_paths = [&quot;&quot;])  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Also sets <a href="module_reference_name">module_set(module_type)</a> to
Msf::SymbolicModule if it is not already set.</p>
</div>
  </div>


<p>Return a module info from Mdm::Module::Details in database.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{String =&gt; Hash{Symbol =&gt; Object}}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Maps path (Mdm::Module::Detail#file) to module information.  Module
information is a Hash derived from Mdm::Module::Detail.  It includes
:modification_time, :parent_path, :type, :reference_name.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/module_manager/cache.rb', line 147</span>

<span class='kw'>def</span> <span class='id identifier rubyid_module_info_by_path_from_database!'>module_info_by_path_from_database!</span><span class='lparen'>(</span><span class='id identifier rubyid_allowed_paths'>allowed_paths</span><span class='op'>=</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_module_info_by_path'>module_info_by_path</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_framework_migrated?'>framework_migrated?</span>
    <span class='id identifier rubyid_allowed_paths'>allowed_paths</span> <span class='op'>=</span> <span class='id identifier rubyid_allowed_paths'>allowed_paths</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>

    <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_connection_pool'>connection_pool</span><span class='period'>.</span><span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span>
      <span class='comment'># TODO record module parent_path in Mdm::Module::Detail so it does not need to be derived from file.
</span>      <span class='comment'># Use find_each so Mdm::Module::Details are returned in batches, which will
</span>      <span class='comment'># handle the growing number of modules better than all.each.
</span>      <span class='const'>Mdm</span><span class='op'>::</span><span class='const'>Module</span><span class='op'>::</span><span class='const'>Detail</span><span class='period'>.</span><span class='id identifier rubyid_find_each'>find_each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_module_detail'>module_detail</span><span class='op'>|</span>
        <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_module_detail'>module_detail</span><span class='period'>.</span><span class='id identifier rubyid_file'>file</span>
        <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_module_detail'>module_detail</span><span class='period'>.</span><span class='id identifier rubyid_mtype'>mtype</span>
        <span class='id identifier rubyid_reference_name'>reference_name</span> <span class='op'>=</span> <span class='id identifier rubyid_module_detail'>module_detail</span><span class='period'>.</span><span class='id identifier rubyid_refname'>refname</span>

        <span class='comment'># Skip cached modules that are not in our allowed load paths
</span>        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_allowed_paths'>allowed_paths</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

        <span class='id identifier rubyid_typed_path'>typed_path</span> <span class='op'>=</span> <span class='const'>Msf</span><span class='op'>::</span><span class='const'>Modules</span><span class='op'>::</span><span class='const'>Loader</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_typed_path'>typed_path</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_reference_name'>reference_name</span><span class='rparen'>)</span>
        <span class='comment'># join to &#39;&#39; so that typed_path_prefix starts with file separator
</span>        <span class='id identifier rubyid_typed_path_suffix'>typed_path_suffix</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_typed_path'>typed_path</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_escaped_typed_path'>escaped_typed_path</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_escape'>escape</span><span class='lparen'>(</span><span class='id identifier rubyid_typed_path_suffix'>typed_path_suffix</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_parent_path'>parent_path</span> <span class='op'>=</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_escaped_typed_path'>escaped_typed_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_module_info_by_path'>module_info_by_path</span><span class='lbracket'>[</span><span class='id identifier rubyid_path'>path</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
            <span class='symbol'>:reference_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_reference_name'>reference_name</span><span class='comma'>,</span>
            <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span>
            <span class='symbol'>:parent_path</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_parent_path'>parent_path</span><span class='comma'>,</span>
            <span class='symbol'>:modification_time</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_module_detail'>module_detail</span><span class='period'>.</span><span class='id identifier rubyid_mtime'>mtime</span>
        <span class='rbrace'>}</span>

        <span class='id identifier rubyid_typed_module_set'>typed_module_set</span> <span class='op'>=</span> <span class='id identifier rubyid_module_set'>module_set</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>

        <span class='comment'># Don&#39;t want to trigger as {Msf::ModuleSet#create} so check for
</span>        <span class='comment'># key instead of using ||= which would call {Msf::ModuleSet#[]}
</span>        <span class='comment'># which would potentially call {Msf::ModuleSet#create}.
</span>        <span class='kw'>unless</span> <span class='id identifier rubyid_typed_module_set'>typed_module_set</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='id identifier rubyid_reference_name'>reference_name</span>
          <span class='id identifier rubyid_typed_module_set'>typed_module_set</span><span class='lbracket'>[</span><span class='id identifier rubyid_reference_name'>reference_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Msf</span><span class='op'>::</span><span class='const'>SymbolicModule</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_module_info_by_path'>module_info_by_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="refresh_cache_from_database-instance_method">
  
    - (<tt>void</tt>) <strong>refresh_cache_from_database</strong>(allowed_paths = [&quot;&quot;]) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Refreshes the in-memory cache from the database cache.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


122
123
124</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/module_manager/cache.rb', line 122</span>

<span class='kw'>def</span> <span class='id identifier rubyid_refresh_cache_from_database'>refresh_cache_from_database</span><span class='lparen'>(</span><span class='id identifier rubyid_allowed_paths'>allowed_paths</span><span class='op'>=</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_module_info_by_path_from_database!'>module_info_by_path_from_database!</span><span class='lparen'>(</span><span class='id identifier rubyid_allowed_paths'>allowed_paths</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="refresh_cache_from_module_files-instance_method">
  
    
      <span class="overload">- (<tt>void</tt>) <strong>refresh_cache_from_module_files</strong> </span>
    
      <span class="overload">- (<tt>void</tt>) <strong>refresh_cache_from_module_files</strong>(module_class_or_instance) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>void</tt>) <strong>refresh_cache_from_module_files</strong> </span>
        <div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Rebuilds database and in-memory cache for all modules.</p>


  </div>
</div>
<div class="tags">
  

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>void</tt>) <strong>refresh_cache_from_module_files</strong>(module_class_or_instance) </span>
        <div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Rebuilds database and in-memory cache for given module_class_or_instance.</p>


  </div>
</div>
<div class="tags">
  

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


108
109
110
111
112
113
114
115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/module_manager/cache.rb', line 108</span>

<span class='kw'>def</span> <span class='id identifier rubyid_refresh_cache_from_module_files'>refresh_cache_from_module_files</span><span class='lparen'>(</span><span class='id identifier rubyid_module_class_or_instance'>module_class_or_instance</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_framework_migrated?'>framework_migrated?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_module_class_or_instance'>module_class_or_instance</span>
      <span class='id identifier rubyid_framework'>framework</span><span class='period'>.</span><span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_update_module_details'>update_module_details</span><span class='lparen'>(</span><span class='id identifier rubyid_module_class_or_instance'>module_class_or_instance</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_framework'>framework</span><span class='period'>.</span><span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_update_all_module_details'>update_all_module_details</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_refresh_cache_from_database'>refresh_cache_from_database</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_module_paths'>module_paths</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Jan 19 22:32:56 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.7).
</div>

  </body>
</html>