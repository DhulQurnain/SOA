<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Msf::Exploit::CmdStager
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Msf/Exploit/CmdStager.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Msf.html" title="Msf (module)">Msf</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span>
     &raquo; 
    <span class="title">CmdStager</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Msf::Exploit::CmdStager
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
      <dt class="r1">Includes:</dt>
      <dd class="r1"><span class='object_link'><a href="EXE.html" title="Msf::Exploit::EXE (module)">EXE</a></span></dd>
      
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/msf/core/exploit/cmdstager.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This mixin provides an interface to generating cmdstagers</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="STAGERS-constant" class="">STAGERS =
          <div class="docstring">
  <div class="discussion">
    
<p>Constant for stagers - used when creating an stager instance.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:bourne</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerBourne</span><span class='comma'>,</span>
  <span class='symbol'>:debug_asm</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerDebugAsm</span><span class='comma'>,</span>
  <span class='symbol'>:debug_write</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerDebugWrite</span><span class='comma'>,</span>
  <span class='symbol'>:echo</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerEcho</span><span class='comma'>,</span>
  <span class='symbol'>:printf</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerPrintf</span><span class='comma'>,</span>
  <span class='symbol'>:vbs</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerVBS</span><span class='comma'>,</span>
  <span class='symbol'>:vbs_adodb</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerVBS</span><span class='comma'>,</span>
  <span class='symbol'>:certutil</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerCertutil</span><span class='comma'>,</span>
  <span class='symbol'>:tftp</span> <span class='op'>=&gt;</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Exploitation</span><span class='op'>::</span><span class='const'>CmdStagerTFTP</span>
<span class='rbrace'>}</span></pre></dd>
      
        <dt id="DECODERS-constant" class="">DECODERS =
          <div class="docstring">
  <div class="discussion">
    
<p>Constant for decoders - used when checking the default flavor decoder.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:debug_asm</span> <span class='op'>=&gt;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Msf</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_install_root'>install_root</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exploits</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cmdstager</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug_asm</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='symbol'>:debug_write</span> <span class='op'>=&gt;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Msf</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_install_root'>install_root</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exploits</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cmdstager</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>debug_write</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='symbol'>:vbs</span> <span class='op'>=&gt;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Msf</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_install_root'>install_root</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exploits</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cmdstager</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vbs_b64</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='symbol'>:vbs_adodb</span> <span class='op'>=&gt;</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Msf</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_install_root'>install_root</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exploits</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cmdstager</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vbs_b64_adodb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='rbrace'>}</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#cmd_list-instance_method" title="#cmd_list (instance method)">- (Object) <strong>cmd_list</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute cmd_list.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#decoder-instance_method" title="#decoder (instance method)">- (Object) <strong>decoder</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute decoder.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#exe-instance_method" title="#exe (instance method)">- (Object) <strong>exe</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute exe.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#flavor-instance_method" title="#flavor (instance method)">- (Object) <strong>flavor</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute flavor.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#stager_instance-instance_method" title="#stager_instance (instance method)">- (Object) <strong>stager_instance</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute stager_instance.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compatible_flavor%3F-instance_method" title="#compatible_flavor? (instance method)">- (Boolean) <strong>compatible_flavor?</strong>(f) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Answers if the input flavor is compatible with the current target or
module.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_stager-instance_method" title="#create_stager (instance method)">- (Rex::Exploitation::CmdStagerBase) <strong>create_stager</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create an instance of the flavored stager.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_decoder-instance_method" title="#default_decoder (instance method)">- (Symbol<sup>?</sup>) <strong>default_decoder</strong>(f) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the default decoder stub for the input flavor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_cmdstager-instance_method" title="#execute_cmdstager (instance method)">- (void) <strong>execute_cmdstager</strong>(opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Executes the command stager while showing the progress.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_cmdstager_begin-instance_method" title="#execute_cmdstager_begin (instance method)">- (Object) <strong>execute_cmdstager_begin</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Code to execute before the cmd stager stub.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_cmdstager_end-instance_method" title="#execute_cmdstager_end (instance method)">- (Object) <strong>execute_cmdstager_end</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Code to execute after the cmd stager stub.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_command-instance_method" title="#execute_command (instance method)">- (Object) <strong>execute_command</strong>(cmd, opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Code called to execute each command via an arbitrary module-defined vector.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_cmdstager-instance_method" title="#generate_cmdstager (instance method)">- (Array) <strong>generate_cmdstager</strong>(opts = {}, pl = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generates a cmd stub based on the current target&#39;s architecture and
platform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#guess_flavor-instance_method" title="#guess_flavor (instance method)">- (Symbol<sup>?</sup>) <strong>guess_flavor</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Guess the cmd stager flavor to use using information from the module,
target or platform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Msf::Module::Exploit) <strong>initialize</strong>(info = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates an instance of an exploit that uses an CMD Stager and register the
datastore options provided by the mixin.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#module_flavors-instance_method" title="#module_flavors (instance method)">- (Array) <strong>module_flavors</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns all the compatible stager flavors specified by the module and each
of its targets.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#opts_with_decoder-instance_method" title="#opts_with_decoder (instance method)">- (Hash) <strong>opts_with_decoder</strong>(opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a hash with the :decoder option if possible.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#progress-instance_method" title="#progress (instance method)">- (void) <strong>progress</strong>(total, sent) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Show the progress of the upload while cmd staging.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#select_cmdstager-instance_method" title="#select_cmdstager (instance method)">- (void) <strong>select_cmdstager</strong>(opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Selects the correct cmd stager and decoder stub to use.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#select_decoder-instance_method" title="#select_decoder (instance method)">- (String<sup>?</sup>) <strong>select_decoder</strong>(opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Selects the correct cmd stager decoder to use based on three rules: (1) use
the decoder provided in input options, (2) use the decoder provided by the
user through datastore options, (3) select the default decoder for the
current cmd stager flavor if available.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#select_flavor-instance_method" title="#select_flavor (instance method)">- (Symbol<sup>?</sup>) <strong>select_flavor</strong>(opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Selects the correct cmd stager to use based on three rules: (1) use the
flavor provided in options, (2) use the flavor provided by the user through
datastore options, (3) guess the flavor using the target platform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#target_flavor-instance_method" title="#target_flavor (instance method)">- (Array, ...) <strong>target_flavor</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the compatible stager flavors for the current target or module.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="EXE.html" title="Msf::Exploit::EXE (module)">EXE</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="EXE.html#exe_init_options-instance_method" title="Msf::Exploit::EXE#exe_init_options (method)">#exe_init_options</a></span>, <span class='object_link'><a href="EXE.html#exe_post_generation-instance_method" title="Msf::Exploit::EXE#exe_post_generation (method)">#exe_post_generation</a></span>, <span class='object_link'><a href="EXE.html#generate_payload_dll-instance_method" title="Msf::Exploit::EXE#generate_payload_dll (method)">#generate_payload_dll</a></span>, <span class='object_link'><a href="EXE.html#generate_payload_exe-instance_method" title="Msf::Exploit::EXE#generate_payload_exe (method)">#generate_payload_exe</a></span>, <span class='object_link'><a href="EXE.html#generate_payload_exe_service-instance_method" title="Msf::Exploit::EXE#generate_payload_exe_service (method)">#generate_payload_exe_service</a></span>, <span class='object_link'><a href="EXE.html#generate_payload_msi-instance_method" title="Msf::Exploit::EXE#generate_payload_msi (method)">#generate_payload_msi</a></span>, <span class='object_link'><a href="EXE.html#get_custom_exe-instance_method" title="Msf::Exploit::EXE#get_custom_exe (method)">#get_custom_exe</a></span>, <span class='object_link'><a href="EXE.html#get_eicar_exe-instance_method" title="Msf::Exploit::EXE#get_eicar_exe (method)">#get_eicar_exe</a></span></p>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="cmd_list=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="cmd_list-instance_method">
  
    - (<tt>Object</tt>) <strong>cmd_list</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute cmd_list</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cmd_list'>cmd_list</span>
  <span class='ivar'>@cmd_list</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="decoder=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="decoder-instance_method">
  
    - (<tt>Object</tt>) <strong>decoder</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute decoder</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 38</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decoder'>decoder</span>
  <span class='ivar'>@decoder</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="exe=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="exe-instance_method">
  
    - (<tt>Object</tt>) <strong>exe</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute exe</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_exe'>exe</span>
  <span class='ivar'>@exe</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="flavor=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="flavor-instance_method">
  
    - (<tt>Object</tt>) <strong>flavor</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute flavor</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 37</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flavor'>flavor</span>
  <span class='ivar'>@flavor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="stager_instance=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="stager_instance-instance_method">
  
    - (<tt>Object</tt>) <strong>stager_instance</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute stager_instance</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 35</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stager_instance'>stager_instance</span>
  <span class='ivar'>@stager_instance</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="compatible_flavor?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>compatible_flavor?</strong>(f) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Answers if the input flavor is compatible with the current target or
module.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>f</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The flavor to check</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>true if compatible, false otherwise.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


292
293
294
295
296
297
298
299
300
301
302
303</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 292</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compatible_flavor?'>compatible_flavor?</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span>
  <span class='kw'>when</span> <span class='const'>String</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span> <span class='op'>==</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>when</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_target_flavor'>target_flavor</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_tr'>tr</span><span class='op'>|</span> <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_tr'>tr</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>==</span> <span class='id identifier rubyid_f'>f</span> <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'>Symbol</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span> <span class='op'>==</span> <span class='id identifier rubyid_f'>f</span>
  <span class='kw'>end</span>
  <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_stager-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Rex/Exploitation/CmdStagerBase.html" title="Rex::Exploitation::CmdStagerBase (class)">Rex::Exploitation::CmdStagerBase</a></span></tt>) <strong>create_stager</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create an instance of the flavored stager.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Rex/Exploitation/CmdStagerBase.html" title="Rex::Exploitation::CmdStagerBase (class)">Rex::Exploitation::CmdStagerBase</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The cmd stager to use.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NoMethodError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>raised if the flavor doesn&#39;t exist.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 180</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_stager'>create_stager</span>
  <span class='const'>STAGERS</span><span class='lbracket'>[</span><span class='id identifier rubyid_flavor'>flavor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_exe'>exe</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default_decoder-instance_method">
  
    - (<tt>Symbol</tt><sup>?</sup>) <strong>default_decoder</strong>(f) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the default decoder stub for the input flavor.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>f</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the input flavor.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the decoder.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if there isn&#39;t a default decoder to use for the current cmd stager
flavor.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 190</span>

<span class='kw'>def</span> <span class='id identifier rubyid_default_decoder'>default_decoder</span><span class='lparen'>(</span><span class='id identifier rubyid_f'>f</span><span class='rparen'>)</span>
  <span class='const'>DECODERS</span><span class='lbracket'>[</span><span class='id identifier rubyid_f'>f</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_cmdstager-instance_method">
  
    - (<tt>void</tt>) <strong>execute_cmdstager</strong>(opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Executes the command stager while showing the progress. This method should
be called from exploits using this mixin.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash containing configuration options. Also allow to send opts to the
Rex::Exploitation::CmdStagerBase constructor.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:flavor</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The CMD Stager to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:decoder</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The decoder stub to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:delay</span>
          <span class="type">(<tt>Float</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Delay between command executions.</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 70</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_cmdstager'>execute_cmdstager</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cmd_list'>cmd_list</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_cmdstager'>generate_cmdstager</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_stager_instance'>stager_instance</span><span class='period'>.</span><span class='id identifier rubyid_setup'>setup</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_execute_cmdstager_begin'>execute_cmdstager_begin</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_sent'>sent</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_total_bytes'>total_bytes</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_cmd_list'>cmd_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='op'>|</span> <span class='id identifier rubyid_total_bytes'>total_bytes</span> <span class='op'>+=</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_delay'>delay</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:delay</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_delay'>delay</span> <span class='op'>||=</span> <span class='float'>0.25</span>

    <span class='id identifier rubyid_cmd_list'>cmd_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='op'>|</span>
      <span class='id identifier rubyid_execute_command'>execute_command</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_sent'>sent</span> <span class='op'>+=</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>

      <span class='comment'># In cases where a server has multiple threads, we want to be sure that
</span>      <span class='comment'># commands we execute happen in the correct (serial) order.
</span>      <span class='op'>::</span><span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_delay'>delay</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_progress'>progress</span><span class='lparen'>(</span><span class='id identifier rubyid_total_bytes'>total_bytes</span><span class='comma'>,</span> <span class='id identifier rubyid_sent'>sent</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_execute_cmdstager_end'>execute_cmdstager_end</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_stager_instance'>stager_instance</span><span class='period'>.</span><span class='id identifier rubyid_teardown'>teardown</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_cmdstager_begin-instance_method">
  
    - (<tt>Object</tt>) <strong>execute_cmdstager_begin</strong>(opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Code to execute before the cmd stager stub. This method is designed to be
overriden by a module this mixin.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Hash of configuration options.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_cmdstager_begin'>execute_cmdstager_begin</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_cmdstager_end-instance_method">
  
    - (<tt>Object</tt>) <strong>execute_cmdstager_end</strong>(opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Code to execute after the cmd stager stub. This method is designed to be
overriden by a module this mixin.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Hash of configuration options.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


316
317</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 316</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_cmdstager_end'>execute_cmdstager_end</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_command-instance_method">
  
    - (<tt>Object</tt>) <strong>execute_command</strong>(cmd, opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Code called to execute each command via an arbitrary module-defined vector.
This method needs to be overriden by modules using this mixin.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cmd</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The command to execute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Hash of configuration options.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>NotImplementedError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 324</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_command'>execute_command</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_cmdstager-instance_method">
  
    - (<tt>Array</tt>) <strong>generate_cmdstager</strong>(opts = {}, pl = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generates a cmd stub based on the current target&#39;s architecture and
platform.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash containing configuration options. Also allow to send opts to the
Rex::Exploitation::CmdStagerBase constructor.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pl</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>String containing the payload to execute</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:flavor</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The CMD Stager to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:decoder</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The decoder stub to use.</p>
</div>
          
        </li>
      
    </ul>
  
    
    

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The list of commands to execute</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>raised if the exe or cmd stub cannot be generated</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 113</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_cmdstager'>generate_cmdstager</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_pl'>pl</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_select_cmdstager'>select_cmdstager</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_exe_opts'>exe_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>code:</span> <span class='id identifier rubyid_pl'>pl</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span>
    <span class='label'>platform:</span> <span class='id identifier rubyid_target_platform'>target_platform</span><span class='comma'>,</span>
    <span class='label'>arch:</span> <span class='id identifier rubyid_target_arch'>target_arch</span>
  <span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_exe'>exe</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_payload_exe'>generate_payload_exe</span><span class='lparen'>(</span><span class='id identifier rubyid_exe_opts'>exe_opts</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_exe'>exe</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The executable could not be generated</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_stager_instance'>stager_instance</span> <span class='op'>=</span> <span class='id identifier rubyid_create_stager'>create_stager</span>
  <span class='id identifier rubyid_cmd_list'>cmd_list</span> <span class='op'>=</span> <span class='id identifier rubyid_stager_instance'>stager_instance</span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='id identifier rubyid_opts_with_decoder'>opts_with_decoder</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_cmd_list'>cmd_list</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_cmd_list'>cmd_list</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The command stager could not be generated</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cmd_list'>cmd_list</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="guess_flavor-instance_method">
  
    - (<tt>Symbol</tt><sup>?</sup>) <strong>guess_flavor</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Guess the cmd stager flavor to use using information from the module,
target or platform.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The cmd stager flavor to use.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if the cmd stager flavor cannot be guessed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 232</span>

<span class='kw'>def</span> <span class='id identifier rubyid_guess_flavor'>guess_flavor</span>
  <span class='comment'># First try to guess a compatible flavor based on the module &amp; target information.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span>
    <span class='kw'>when</span> <span class='const'>Array</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
    <span class='kw'>when</span> <span class='const'>String</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
    <span class='kw'>when</span> <span class='const'>Symbol</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Second try to guess a compatible flavor based on the target platform.
</span>  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_target_platform'>target_platform</span><span class='period'>.</span><span class='id identifier rubyid_names'>names</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span>
  <span class='id identifier rubyid_c_platform'>c_platform</span> <span class='op'>=</span> <span class='id identifier rubyid_target_platform'>target_platform</span><span class='period'>.</span><span class='id identifier rubyid_names'>names</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_c_platform'>c_platform</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>linux</span><span class='regexp_end'>/i</span></span>
    <span class='symbol'>:bourne</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>osx</span><span class='regexp_end'>/i</span></span>
    <span class='symbol'>:bourne</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>unix</span><span class='regexp_end'>/i</span></span>
    <span class='symbol'>:bourne</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>win</span><span class='regexp_end'>/i</span></span>
    <span class='symbol'>:vbs</span>
  <span class='kw'>else</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize-instance_method">
  
    - (<tt>Msf::Module::Exploit</tt>) <strong>initialize</strong>(info = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates an instance of an exploit that uses an CMD Stager and register the
datastore options provided by the mixin.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>info</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash containing information to initialize the exploit.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Msf::Module::Exploit</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the exploit module.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 46</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>super</span>

  <span class='id identifier rubyid_flavors'>flavors</span> <span class='op'>=</span> <span class='id identifier rubyid_module_flavors'>module_flavors</span>
  <span class='id identifier rubyid_flavors'>flavors</span> <span class='op'>=</span> <span class='const'>STAGERS</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='kw'>if</span> <span class='id identifier rubyid_flavors'>flavors</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_flavors'>flavors</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>auto</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_register_advanced_options'>register_advanced_options</span><span class='lparen'>(</span>
    <span class='lbracket'>[</span>
      <span class='const'>OptEnum</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CMDSTAGER::FLAVOR</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='kw'>false</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The CMD Stager to use.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>auto</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_flavors'>flavors</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='const'>OptString</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CMDSTAGER::DECODER</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='kw'>false</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The decoder stub to use.</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="module_flavors-instance_method">
  
    - (<tt>Array</tt>) <strong>module_flavors</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns all the compatible stager flavors specified by the module and each
of its targets.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the list of all compatible cmd stager flavors.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


266
267
268
269
270
271
272
273
274</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 266</span>

<span class='kw'>def</span> <span class='id identifier rubyid_module_flavors'>module_flavors</span>
  <span class='id identifier rubyid_flavors'>flavors</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flavors'>flavors</span> <span class='op'>+=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_module_info'>module_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CmdStagerFlavor</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_module_info'>module_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CmdStagerFlavor</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_targets'>targets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_target'>target</span><span class='op'>|</span>
    <span class='id identifier rubyid_flavors'>flavors</span> <span class='op'>+=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CmdStagerFlavor</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CmdStagerFlavor</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_flavors'>flavors</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
  <span class='id identifier rubyid_flavors'>flavors</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_flavor'>flavor</span><span class='op'>|</span> <span class='id identifier rubyid_flavor'>flavor</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="opts_with_decoder-instance_method">
  
    - (<tt>Hash</tt>) <strong>opts_with_decoder</strong>(opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a hash with the :decoder option if possible</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Input Hash.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Hash with the input data and a :decoder option when possible.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


169
170
171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 169</span>

<span class='kw'>def</span> <span class='id identifier rubyid_opts_with_decoder'>opts_with_decoder</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_opts'>opts</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:decoder</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='symbol'>:decoder</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_decoder'>decoder</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_decoder'>decoder</span>
  <span class='id identifier rubyid_opts'>opts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="progress-instance_method">
  
    - (<tt>void</tt>) <strong>progress</strong>(total, sent) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Show the progress of the upload while cmd staging</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>total</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The total number of bytes to send.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sent</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The number of bytes sent.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


141
142
143
144
145</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 141</span>

<span class='kw'>def</span> <span class='id identifier rubyid_progress'>progress</span><span class='lparen'>(</span><span class='id identifier rubyid_total'>total</span><span class='comma'>,</span> <span class='id identifier rubyid_sent'>sent</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_done'>done</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_sent'>sent</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_total'>total</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='int'>100</span>
  <span class='id identifier rubyid_percent'>percent</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%3.2f%%</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_done'>done</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
  <span class='id identifier rubyid_print_status'>print_status</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Command Stager progress - %7s done (%d/%d bytes)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_percent'>percent</span><span class='comma'>,</span> <span class='id identifier rubyid_sent'>sent</span><span class='comma'>,</span> <span class='id identifier rubyid_total'>total</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="select_cmdstager-instance_method">
  
    - (<tt>void</tt>) <strong>select_cmdstager</strong>(opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Selects the correct cmd stager and decoder stub to use</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash containing the options to select the correct cmd stager and decoder.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:flavor</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The cmd stager to use.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:decoder</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The decoder stub to use.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>raised if a cmd stager cannot be selected or it isn&#39;t compatible with
the target platform.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 156</span>

<span class='kw'>def</span> <span class='id identifier rubyid_select_cmdstager'>select_cmdstager</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_flavor'>flavor</span> <span class='op'>=</span> <span class='id identifier rubyid_select_flavor'>select_flavor</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to select CMD Stager</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_flavor'>flavor</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The CMD Stager &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_flavor'>flavor</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; isn&#39;t compatible with the target</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_compatible_flavor?'>compatible_flavor?</span><span class='lparen'>(</span><span class='id identifier rubyid_flavor'>flavor</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_decoder'>decoder</span> <span class='op'>=</span> <span class='id identifier rubyid_select_decoder'>select_decoder</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="select_decoder-instance_method">
  
    - (<tt>String</tt><sup>?</sup>) <strong>select_decoder</strong>(opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Selects the correct cmd stager decoder to use based on three rules: (1) use
the decoder provided in input options, (2) use the decoder provided by the
user through datastore options, (3) select the default decoder for the
current cmd stager flavor if available.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash containing the options to select the correct decoder.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:decoder</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The decoder stub to use.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The decoder.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if a decoder cannot be selected.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


204
205
206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 204</span>

<span class='kw'>def</span> <span class='id identifier rubyid_select_decoder'>select_decoder</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:decoder</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:decoder</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_datastore'>datastore</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CMDSTAGER::DECODER</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_datastore'>datastore</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CMDSTAGER::DECODER</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='id identifier rubyid_default_decoder'>default_decoder</span><span class='lparen'>(</span><span class='id identifier rubyid_flavor'>flavor</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="select_flavor-instance_method">
  
    - (<tt>Symbol</tt><sup>?</sup>) <strong>select_flavor</strong>(opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Selects the correct cmd stager to use based on three rules: (1) use the
flavor provided in options, (2) use the flavor provided by the user through
datastore options, (3) guess the flavor using the target platform.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash containing the options to select the correct cmd stager</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:flavor</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The cmd stager flavor to use.</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The flavor to use.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if a flavor cannot be selected.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220
221
222
223
224
225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 219</span>

<span class='kw'>def</span> <span class='id identifier rubyid_select_flavor'>select_flavor</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:flavor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:flavor</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_datastore'>datastore</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CMDSTAGER::FLAVOR</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='kw'>or</span> <span class='id identifier rubyid_datastore'>datastore</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CMDSTAGER::FLAVOR</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>auto</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_datastore'>datastore</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CMDSTAGER::FLAVOR</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_guess_flavor'>guess_flavor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="target_flavor-instance_method">
  
    - (<tt>Array</tt>, ...) <strong>target_flavor</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the compatible stager flavors for the current target or module.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the list of compatible cmd stager flavors.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the compatible cmd stager flavor.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the compatible cmd stager flavor.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if there isn&#39;t any compatible flavor defined.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


282
283
284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/cmdstager.rb', line 282</span>

<span class='kw'>def</span> <span class='id identifier rubyid_target_flavor'>target_flavor</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CmdStagerFlavor</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CmdStagerFlavor</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_module_info'>module_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CmdStagerFlavor</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_module_info'>module_info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CmdStagerFlavor</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Jan 19 22:32:14 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.7).
</div>

  </body>
</html>