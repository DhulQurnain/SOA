<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Msf::ExploitDriver
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Msf/ExploitDriver.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (E)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Msf.html" title="Msf (module)">Msf</a></span></span>
     &raquo; 
    <span class="title">ExploitDriver</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Msf::ExploitDriver
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Msf::ExploitDriver</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/msf/core/exploit_driver.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This class drives the exploitation process from start to finish for a given
exploit module instance.  It&#39;s responsible for payload generation,
encoding, and padding as well as initialization handlers and finally
launching the exploit.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#exploit-instance_method" title="#exploit (instance method)">- (Object) <strong>exploit</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#force_wait_for_session-instance_method" title="#force_wait_for_session (instance method)">- (Object) <strong>force_wait_for_session</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#job_id-instance_method" title="#job_id (instance method)">- (Object) <strong>job_id</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The identifier of the job this exploit is launched as, if it&#39;s run as a
job.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#payload-instance_method" title="#payload (instance method)">- (Object) <strong>payload</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#semaphore-instance_method" title="#semaphore (instance method)">- (Object) <strong>semaphore</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>To synchronize threads cleaning up the exploit and the handler.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#session-instance_method" title="#session (instance method)">- (Object) <strong>session</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#use_job-instance_method" title="#use_job (instance method)">- (Object) <strong>use_job</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compatible_payload%3F-instance_method" title="#compatible_payload? (instance method)">- (Boolean) <strong>compatible_payload?</strong>(payload) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks to see if the supplied payload is compatible with the current
exploit.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (ExploitDriver) <strong>initialize</strong>(framework) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initializes the exploit driver using the supplied framework instance.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#job_cleanup_proc-instance_method" title="#job_cleanup_proc (instance method)">- (Object) <strong>job_cleanup_proc</strong>(ctx) </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clean up the exploit and the handler after the job completes.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#job_run_proc-instance_method" title="#job_run_proc (instance method)">- (Object) <strong>job_run_proc</strong>(ctx) </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Job run proc, sets up the exploit and kicks it off.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (Object) <strong>run</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Kicks off an exploitation attempt and performs the following four major
operations:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#target_idx-instance_method" title="#target_idx (instance method)">- (Object) <strong>target_idx</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method returns the currently selected target index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#target_idx%3D-instance_method" title="#target_idx= (instance method)">- (Object) <strong>target_idx=</strong>(target_idx) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Specification of the exploit target index.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate-instance_method" title="#validate (instance method)">- (Object) <strong>validate</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Makes sure everything&#39;s in tip-top condition prior to launching the
exploit.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Msf::ExploitDriver (class)">ExploitDriver</a></span></tt>) <strong>initialize</strong>(framework) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initializes the exploit driver using the supplied framework instance.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_framework'>framework</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span>                <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_exploit'>exploit</span>                <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_use_job'>use_job</span>                <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_job_id'>job_id</span>                 <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_force_wait_for_session'>force_wait_for_session</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_semaphore'>semaphore</span>              <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="exploit=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="exploit-instance_method">
  
    - (<tt>Object</tt>) <strong>exploit</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_exploit'>exploit</span>
  <span class='ivar'>@exploit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="force_wait_for_session=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="force_wait_for_session-instance_method">
  
    - (<tt>Object</tt>) <strong>force_wait_for_session</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_force_wait_for_session'>force_wait_for_session</span>
  <span class='ivar'>@force_wait_for_session</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="job_id=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="job_id-instance_method">
  
    - (<tt>Object</tt>) <strong>job_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The identifier of the job this exploit is launched as, if it&#39;s run as a
job.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 181</span>

<span class='kw'>def</span> <span class='id identifier rubyid_job_id'>job_id</span>
  <span class='ivar'>@job_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="payload=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="payload-instance_method">
  
    - (<tt>Object</tt>) <strong>payload</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 175</span>

<span class='kw'>def</span> <span class='id identifier rubyid_payload'>payload</span>
  <span class='ivar'>@payload</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="semaphore=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="semaphore-instance_method">
  
    - (<tt>Object</tt>) <strong>semaphore</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>To synchronize threads cleaning up the exploit and the handler</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 186</span>

<span class='kw'>def</span> <span class='id identifier rubyid_semaphore'>semaphore</span>
  <span class='ivar'>@semaphore</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="session=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="session-instance_method">
  
    - (<tt>Object</tt>) <strong>session</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 183</span>

<span class='kw'>def</span> <span class='id identifier rubyid_session'>session</span>
  <span class='ivar'>@session</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="use_job=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="use_job-instance_method">
  
    - (<tt>Object</tt>) <strong>use_job</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 176</span>

<span class='kw'>def</span> <span class='id identifier rubyid_use_job'>use_job</span>
  <span class='ivar'>@use_job</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="compatible_payload?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>compatible_payload?</strong>(payload) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks to see if the supplied payload is compatible with the current
exploit.  Assumes that target_idx is valid.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 54</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compatible_payload?'>compatible_payload?</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
  <span class='comment'># Try to use the target&#39;s platform in preference of the exploit&#39;s
</span>  <span class='id identifier rubyid_exp_platform'>exp_platform</span> <span class='op'>=</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_targets'>targets</span><span class='lbracket'>[</span><span class='id identifier rubyid_target_idx'>target_idx</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_platform'>platform</span> <span class='op'>||</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_platform'>platform</span>

  <span class='kw'>return</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_platform'>platform</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_exp_platform'>exp_platform</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>==</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="job_cleanup_proc-instance_method">
  
    - (<tt>Object</tt>) <strong>job_cleanup_proc</strong>(ctx)  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clean up the exploit and the handler after the job completes.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


243
244
245
246
247
248
249
250
251
252
253</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 243</span>

<span class='kw'>def</span> <span class='id identifier rubyid_job_cleanup_proc'>job_cleanup_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_ctx'>ctx</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exploit'>exploit</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>

  <span class='comment'># Ensure that, no matter what, clean up of the handler occurs
</span>  <span class='id identifier rubyid_semaphore'>semaphore</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_stop_handler'>stop_handler</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_framework'>framework</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_on_module_complete'>on_module_complete</span><span class='lparen'>(</span><span class='id identifier rubyid_exploit'>exploit</span><span class='rparen'>)</span>

  <span class='comment'># Allow the exploit to cleanup after itself, that messy bugger.
</span>  <span class='id identifier rubyid_semaphore'>semaphore</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_cleanup'>cleanup</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="job_run_proc-instance_method">
  
    - (<tt>Object</tt>) <strong>job_run_proc</strong>(ctx)  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Job run proc, sets up the exploit and kicks it off.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 193</span>

<span class='kw'>def</span> <span class='id identifier rubyid_job_run_proc'>job_run_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_ctx'>ctx</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_exploit'>exploit</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>
    <span class='comment'># Default session wait time..
</span>    <span class='id identifier rubyid_delay'>delay</span> <span class='op'>=</span> <span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_wfs_delay'>wfs_delay</span> <span class='op'>+</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_wfs_delay'>wfs_delay</span>
    <span class='id identifier rubyid_delay'>delay</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_passive?'>passive?</span>

    <span class='comment'># Set the exploit up the bomb
</span>    <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_setup'>setup</span>

    <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_framework'>framework</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_on_module_run'>on_module_run</span><span class='lparen'>(</span><span class='id identifier rubyid_exploit'>exploit</span><span class='rparen'>)</span>

    <span class='comment'># Launch the exploit
</span>    <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_exploit'>exploit</span>

  <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='kw'>if</span> <span class='lbracket'>[</span><span class='op'>::</span><span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Interrupt</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rparen'>)</span>
      <span class='comment'># Wait for session, but don&#39;t wait long.
</span>      <span class='id identifier rubyid_delay'>delay</span> <span class='op'>=</span> <span class='float'>0.01</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_handle_exception'>handle_exception</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>end</span>

  <span class='comment'># Wait the payload to acquire a session if this isn&#39;t a passive-style
</span>  <span class='comment'># exploit.
</span>  <span class='kw'>return</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_delay'>delay</span>


  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_force_wait_for_session'>force_wait_for_session</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>or</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_passive?'>passive?</span> <span class='op'>==</span> <span class='kw'>false</span> <span class='kw'>and</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_handler_enabled?'>handler_enabled?</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_wait_for_session'>wait_for_session</span><span class='lparen'>(</span><span class='id identifier rubyid_delay'>delay</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Interrupt</span>
      <span class='comment'># Don&#39;t let interrupt pass upward
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_session'>session</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_session'>session</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_fail_reason'>fail_reason</span> <span class='op'>==</span> <span class='const'>Msf</span><span class='op'>::</span><span class='const'>Exploit</span><span class='op'>::</span><span class='const'>Failure</span><span class='op'>::</span><span class='const'>None</span>
    <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_fail_reason'>fail_reason</span> <span class='op'>=</span> <span class='const'>Msf</span><span class='op'>::</span><span class='const'>Exploit</span><span class='op'>::</span><span class='const'>Failure</span><span class='op'>::</span><span class='const'>PayloadFailed</span>
    <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_fail_detail'>fail_detail</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No session created</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_report_failure'>report_failure</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run-instance_method">
  
    - (<tt>Object</tt>) <strong>run</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Kicks off an exploitation attempt and performs the following four major
operations:</p>

<pre class="code ruby"><code class="ruby">- Generates the payload
- Initializes &amp; monitors the handler
- Launches the exploit
- Cleans up the handler</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 115</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span>
  <span class='comment'># First thing&#39;s first -- validate the state.  Make sure all requirement
</span>  <span class='comment'># parameters are set, including those that are derived from the
</span>  <span class='comment'># datastore.
</span>  <span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='rparen'>)</span>

  <span class='comment'># After validation has occurred, it&#39;s time to set some values on the
</span>  <span class='comment'># exploit instance and begin preparing the payload
</span>  <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_datastore'>datastore</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TARGET</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_target_idx'>target_idx</span>

  <span class='comment'># Default the session to nil
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='comment'># Explicitly clear the module&#39;s job_id in case it was set in a previous
</span>  <span class='comment'># run
</span>  <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_job_id'>job_id</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='comment'># If we are being instructed to run as a job then let&#39;s create that job
</span>  <span class='comment'># like a good person.
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_use_job'>use_job</span> <span class='kw'>or</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_stance'>stance</span> <span class='op'>==</span> <span class='const'>Msf</span><span class='op'>::</span><span class='const'>Exploit</span><span class='op'>::</span><span class='const'>Stance</span><span class='op'>::</span><span class='const'>Passive</span><span class='rparen'>)</span>
    <span class='comment'># Since references to the exploit and payload will hang around for
</span>    <span class='comment'># awhile in the job, make sure we copy them so further changes to
</span>    <span class='comment'># the datastore don&#39;t alter settings in existing jobs
</span>    <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_replicant'>replicant</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_replicant'>replicant</span>

    <span class='comment'># Assign the correct exploit instance to the payload
</span>    <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_assoc_exploit'>assoc_exploit</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span>

    <span class='comment'># Generate the encoded version of the supplied payload for the
</span>    <span class='comment'># newly copied exploit module instance
</span>    <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_generate_payload'>generate_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span> <span class='rbracket'>]</span>

    <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_job_id'>job_id</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_framework'>framework</span><span class='period'>.</span><span class='id identifier rubyid_jobs'>jobs</span><span class='period'>.</span><span class='id identifier rubyid_start_bg_job'>start_bg_job</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Exploit: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_refname'>refname</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span>
      <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ctx_'>ctx_</span><span class='op'>|</span> <span class='id identifier rubyid_job_run_proc'>job_run_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_ctx_'>ctx_</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ctx_'>ctx_</span><span class='op'>|</span> <span class='id identifier rubyid_job_cleanup_proc'>job_cleanup_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_ctx_'>ctx_</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_job_id'>job_id</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_job_id'>job_id</span>
  <span class='kw'>else</span>
    <span class='comment'># Generate the encoded version of the supplied payload on the
</span>    <span class='comment'># exploit module instance
</span>    <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_generate_payload'>generate_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>

    <span class='comment'># No need to copy since we aren&#39;t creating a job.  We wait until
</span>    <span class='comment'># they&#39;re finished running to do anything else with them, so
</span>    <span class='comment'># nothing should be able to modify their datastore or other
</span>    <span class='comment'># settings until after they&#39;re done.
</span>    <span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span> <span class='rbracket'>]</span>

    <span class='id identifier rubyid_job_run_proc'>job_run_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_ctx'>ctx</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_job_cleanup_proc'>job_cleanup_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_ctx'>ctx</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_session'>session</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="target_idx-instance_method">
  
    - (<tt>Object</tt>) <strong>target_idx</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method returns the currently selected target index.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 46</span>

<span class='kw'>def</span> <span class='id identifier rubyid_target_idx'>target_idx</span>
  <span class='ivar'>@target_idx</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="target_idx=-instance_method">
  
    - (<tt>Object</tt>) <strong>target_idx=</strong>(target_idx) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Specification of the exploit target index.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_target_idx='>target_idx=</span><span class='lparen'>(</span><span class='id identifier rubyid_target_idx'>target_idx</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_target_idx'>target_idx</span><span class='rparen'>)</span>
    <span class='comment'># Make sure the target index is valid
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_target_idx'>target_idx</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_targets'>targets</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid target index.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_caller'>caller</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

   <span class='comment'># Set the active target
</span>  <span class='ivar'>@target_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_target_idx'>target_idx</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate-instance_method">
  
    - (<tt>Object</tt>) <strong>validate</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Makes sure everything&#39;s in tip-top condition prior to launching the
exploit.  For things that aren&#39;t good to go, an exception is thrown.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit_driver.rb', line 71</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate'>validate</span>
  <span class='comment'># First, validate that a target has been selected
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_target_idx'>target_idx</span> <span class='op'>==</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MissingTargetError</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A payload cannot be selected until a target is specified.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='id identifier rubyid_caller'>caller</span>
  <span class='kw'>end</span>

  <span class='comment'># Next, validate that a payload has been selected
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span> <span class='op'>==</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MissingPayloadError</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A payload has not been selected.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_caller'>caller</span>
  <span class='kw'>end</span>

  <span class='comment'># Make sure the payload is compatible after all
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_compatible_payload?'>compatible_payload?</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>IncompatiblePayloadError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_refname'>refname</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Incompatible payload</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_caller'>caller</span>
  <span class='kw'>end</span>

  <span class='comment'># Associate the payload instance with the exploit
</span>  <span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_assoc_exploit'>assoc_exploit</span> <span class='op'>=</span> <span class='id identifier rubyid_exploit'>exploit</span>

  <span class='comment'># Finally, validate options on the exploit module to ensure that things
</span>  <span class='comment'># are ready to operate as they should.
</span>  <span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='id identifier rubyid_exploit'>exploit</span><span class='period'>.</span><span class='id identifier rubyid_datastore'>datastore</span><span class='rparen'>)</span>

  <span class='comment'># Validate the payload&#39;s options.  The payload&#39;s datastore is
</span>  <span class='comment'># most likely shared against the exploit&#39;s datastore, but in case it
</span>  <span class='comment'># isn&#39;t.
</span>  <span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_datastore'>datastore</span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Jan 19 22:35:50 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.7).
</div>

  </body>
</html>